<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="program">

	<select id = "selectProgram" parameterType="map" resultType="contribution.model.Program">
		select * from programs where organization_id = #{organization_id} AND program_id = #{program_id}
	</select>
	<select id = "selectProgramCount" parameterType="String" resultType="int">
		select count(*)as cnt from programs where organization_id = #{organization_id}
	</select>
	
	<select id = "selectAllType" resultType="contribution.model.Type">
		select * from types
	</select>
	
	<select id = "selectType" resultType = "String" parameterType="int">
		select type from types where type_id = #{type_id}
	</select>
	
	<insert id="insertProgram" parameterType="contribution.model.Program">
		insert into programs(organization_id, program_id, program_subject, type_id, start_date, end_date, target_amount, purpose, summary, content, organization_url, bank_name, account, corporate_registration_number, zip, address, address_detail, phone_number, representative) values (#{organization_id}, #{program_id}, #{program_subject}, #{type_id}, #{start_date}, #{end_date}, #{target_amount}, #{purpose}, #{summary}, #{content}, #{organization_url}, #{bank_name}, #{account}, #{corporate_registration_number}, #{zip}, #{address}, #{address_detail}, #{phone_number}, #{representative})
	</insert>
	
	<!-- 메인, 프로그램리스트에서 분야별로 검색 -->
	<select id = "selectTypeProgram" parameterType = "int" resultType="map">
		select program_subject, summary from programs where program_id = #{program_id} and organization_id = #{organization_id} and type_id = #{type_id}
	</select>
	
	<!-- 메인, 프로그램리스트에서 전체 검색 -->
	<select id = "selectAllProgram" parameterType = "int" resultType="map">
		select program_subject, summary from programs where program_id = #{program_id} and organization_id = #{organization_id}
	</select>
	
	<!-- 프로그램의 모든 이미지 -->
	<select id = "selectProgramImages" parameterType = "map" resultType = "contribution.model.ProgramImage">
		select * from program_images where program_id = #{program_id} and organization_id = #{organization_id}
	</select>
	
	<!-- 프로그램수정 -->
	<update id="updateProgram" parameterType = "contribution.model.Program" >
		update programs set program_subject = #{program_subject}, type_id = #{type_id}, start_date = #{start_date}, end_date = #{end_date}, target_amount = #{target_amount}, purpose = #{purpose}, summary = #{summary}, content = #{content}, organization_url = #{organization_url}, bank_name = #{bank_name}, account = #{account}, corporate_registration_number = #{corporate_registration_number}, zip = #{zip}, address = #{address}, address_detail = #{address_detail}, phone_number = #{phone_number}, representative = #{representative}, banner_file_name = #{banner_file_name} where program_id = #{program_id} AND organization_id = #{organization_id}
	</update>
	
	<!-- 프로그램 이미지 등록 -->
	<insert id="insertProgramImage" parameterType="contribution.model.ProgramImage">
		insert into program_images (program_id, organization_id, stored_file_name, image_url, original_file_name) values (#{program_id}, #{organization_id}, #{stored_file_name}, #{image_url}, #{original_file_name})
	</insert>
	
	<!-- 관리자 - 신청한 프로그램 전체 확인 -->
	<select id="selectAllRequestProgram" resultType="contribution.model.Program">
		select * from programs
	</select>
	
	<!-- 승인, 미승인 프로그램 확인 -->
	<select id="selectApprovalProgram" parameterType="int" resultType="contribution.model.Program">
		select * from programs where approval_flg = #{approval_flg}
	</select>
	
		<!-- 관리자용 신청프로그램리스트 -->
	<select id = "selectAllRequestProgramList" resultType="contribution.model.Program">
		select program_id, program_subject, start_date, end_date, approval_date, approval_flg, organization_id from programs;
	</select>
	
	<!-- 관리자용 승인 수정 -->
	<update id="updateApprovalFlg" parameterType="map">
		update programs set approval_flg = #{approval_flg} where program_id = #{program_id} AND organization_id = #{organization_id}
	</update>
</mapper>